/**
 * Ќесколько несложных тестов, провер€ющих конвертирование 
 * дес€тичной дроби в формат с плавающей точкой IEEE-754
 * (“олько числа одинарной и двойной точности)
 *
 *  араваев јртЄм ћихайлович, http://zealcomputing.ru
 * 26.12.2015
 *
 */

#include <stdio.h>



// —труктура дл€ получени€ представлени€ float как unsigned int
union {
  unsigned int asInt;
  float asFloat;
} f32;

// —труктура дл€ получени€ представлени€ double как unsigned long long
union {
  unsigned long long asInt;
  double asFloat;
} f64;



// “естирование числа одинарной точности
void test32 ( float a, unsigned int right, int testNumber ) {
  f32 . asFloat = a;
  if ( f32 . asInt != right )
    fprintf ( stderr, "Error on test %d: 0x%08x != 0x%08x\n", testNumber, f32 . asInt, right );
  else
    fprintf ( stderr, "Right on test %d\n", testNumber );
}

// “естирование числа двойной точности
void test64 ( double a, unsigned long long right, int testNumber ) {
  f64 . asFloat = a;
  if ( f64 . asInt != right )
    fprintf ( stderr, "Error on test %d: 0x%016llx != 0x%016llx\n", testNumber, f64 . asInt, right );
  else
    fprintf ( stderr, "Right on test %d\n", testNumber );
}



// —писок чисел одинарной точности и правильных двоичных представлений этих чисел
const int N32 = 8;

const float Test32 [ N32 ] = { 
  21267649200209254194690314461188718593.0f,
  1.175494280757364291727882991035766513322e-38f,
  1.175494280757364291727882991035766513323e-38f,
  10749727.50000000000000000000000000000001f,
  10749728.50000000000000000000000000000001f,
  -1.175494420887210724209590083408724842314e-38f,
  -1.175494420887210724209590083408724842315e-38f,
  -340282336497324057985868971510891282432.1f
};

const unsigned int Right32 [ N32 ] = { 
  0x7d800001,
  0x007fffff,
  0x00800000,
  0x4b240720,
  0x4b240721,
  0x80800000, 
  0x80800001,
  0xff7fffff
};



// —писок чисел двойной точности и правильных двоичных представлений этих чисел
const int N64 = 24;

const double Test64 [ N64 ] = { 
  -2.470328229206232720882843964341106861825e-324,
  -2.470328229206232720882843964341106861826e-324,
  2.225073858507200641991763955462587799366e-308,
  2.225073858507200641991763955462587799367e-308,
  6755399441055826.499999999999999999999999,
  6755399441055826.500000000000000000000001,
  179769313486231560835325876058105298516207002341652166261661174625869553267292326574530099287946549246750631490335877017522087105926987962906277604735569213290190919152394180476217125334960946356387261286640198029037799514183602981511756283727771403830521483963923935633133642802139091669457927874464075218944.1,
  11417981541647677146990387413251858846007164927.9,
  11417981541647677146990387413251858846007164928.0,
  11417981541647677146990387413251858846007164928.1,  
  11417981541647677780815687527366559594358767616.0,
  179769313486231560835325876058105298516207002341652166261661174625869553267292326574530099287946549246750631490335877017522087105926987962906277604735569213290190919152394180476217125334960946356387261286640198029037799514183602981511756283727771403830521483963923935633133642802139091669457927874464075218943.9,
  179769313486231560835325876058105298516207002341652166261661174625869553267292326574530099287946549246750631490335877017522087105926987962906277604735569213290190919152394180476217125334960946356387261286640198029037799514183602981511756283727771403830521483963923935633133642802139091669457927874464075218944.0,
  179769313486231560835325876058105298516207002341652166261661174625869553267292326574530099287946549246750631490335877017522087105926987962906277604735569213290190919152394180476217125334960946356387261286640198029037799514183602981511756283727771403830521483963923935633133642802139091669457927874464075218944.1,
  9214843084008499.0,
  0.500000000000000166533453693773481063544750213623046875,
  30078505129381147446200.0,
  3.518437208883201171875e13,
  8.10109172351e-10,
  9007199254740991.4999999999999999999999999999999995,
  -2.4703282292062327208828439643411068618252990130716238221279284125033775363510437593264991818081799618989828234772285886546332835517796989819938739800539093906315035659515570226392290858392449105184435931802849936536152500319370457678249219365623669863658480757001585769269903706311928279558551332927834338409351978015531246597263579574622766465272827220056374006485499977096599470454020828166226237857393450736339007967761930577506740176324673600968951340535537458516661134223766678604162159680461914467291840300530057530849048765391711386591646239524912623653881879636239373280423891018672348497668235089863388587925628302755995657524455507255189313690836254779186948667994968324049705821028513185451396213837722826145437693412532098591327667236328125001e-324,
  6755399441055827.499999999999999999999999,
  6755399441055827.5,
  6755399441055827.500000000000000000000001
};

const unsigned long long Right64 [ N64 ] = { 
  0x8000000000000000,
  0x8000000000000001,
  0x000ffffffffffffe, 
  0x000fffffffffffff,
  0x4338000000000052,
  0x4338000000000053,
  0x7fefffffffffffff,
  0x497ffffffffffffe,
  0x497ffffffffffffe,
  0x497fffffffffffff,
  0x497fffffffffffff,
  0x7feffffffffffffe,
  0x7feffffffffffffe,
  0x7fefffffffffffff,
  0x43405e6cec57761a,
  0x3fe0000000000002,
  0x44997a3c7271b021,
  0x42c0000000000002,
  0x3e0bd5cbaef0fd0c,
  0x433fffffffffffff,
  0x8000000000000001,
  0x4338000000000053,
  0x4338000000000054,
  0x4338000000000054
};



int main ( ) {

  // ѕроверка всех чисел одинарной точности в цикле	
  fprintf ( stderr, "\n\n::: Single precision :::\n" );
  for ( int i = 0; i < N32; i ++ )
    test32 ( Test32 [ i ], Right32 [ i ], i );

  // ѕроверка всех чисел двойной точности в цикле
  fprintf ( stderr, "\n::: Double precision :::\n" );
  for ( int i = 0; i < N64; i ++ )
    test64 ( Test64 [ i ], Right64 [ i ], i );

  return 0;
}
